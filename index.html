<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>簡易文字樣式設定器 V4</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Quill CSS CDN -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        /* 自訂樣式 */
        .ql-editor .background-span {
            background-color: var(--bg-color);
            color: var(--text-color);
            border-radius: 0.25rem; /* Tailwind's rounded */
            padding: 0 0.2rem;
            margin: 0 0.1rem;
            display: inline-block;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* 隱藏 Quill 的預設背景色 */
        .ql-editor .ql-background {
            background-color: transparent;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white shadow-md rounded-lg p-6 w-full max-w-3xl">
        <h1 class="text-2xl font-bold mb-4 text-center">簡易文字樣式設定器</h1>
        
        <!-- 文字輸入區 -->
        <div class="mb-4">
            <label for="editor" class="block text-gray-700 mb-2">輸入您的文字：</label>
            <!-- Quill 編輯器 -->
            <div id="editor" class="border border-gray-300 rounded p-2 min-h-[150px] focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
        </div>
        
        <!-- 樣式設定工具列 -->
        <div class="mb-4 flex space-x-4">
            <div>
                <label class="block text-gray-700 mb-1">粗體</label>
                <button id="boldBtn" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">B</button>
            </div>
            <div>
                <label class="block text-gray-700 mb-1">文字顏色</label>
                <input type="color" id="textColorPicker" class="w-12 h-10 p-0 border-none">
            </div>
            <div>
                <label class="block text-gray-700 mb-1">背景顏色</label>
                <input type="color" id="bgColorPicker" class="w-12 h-10 p-0 border-none">
            </div>
        </div>
        
        <!-- 顯示效果 -->
        <div class="mb-4">
            <h2 class="text-xl font-semibold mb-2">顯示效果：</h2>
            <div id="preview" class="border border-gray-300 rounded p-4 min-h-[150px] bg-gray-50"></div>
        </div>
        
        <!-- HTML 原始碼顯示與複製按鈕 -->
        <div class="mb-4">
            <h2 class="text-xl font-semibold mb-2">HTML 原始碼：</h2>
            <textarea id="htmlOutput" class="w-full border border-gray-300 rounded p-2 min-h-[150px] bg-gray-50" readonly></textarea>
            <button id="copyBtn" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">一鍵複製</button>
        </div>
    </div>

    <!-- Quill JS CDN -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <!-- JavaScript 部分 -->
    <script>
        // 初始化 Quill 編輯器
        const quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: false // 我們將自訂工具列
            }
        });

        // 按鈕和選擇器元素
        const boldBtn = document.getElementById('boldBtn');
        const textColorPicker = document.getElementById('textColorPicker');
        const bgColorPicker = document.getElementById('bgColorPicker');
        const preview = document.getElementById('preview');
        const htmlOutput = document.getElementById('htmlOutput');
        const copyBtn = document.getElementById('copyBtn');

        // 監聽粗體按鈕
        boldBtn.addEventListener('click', () => {
            const range = quill.getSelection();
            if (range) {
                const currentFormat = quill.getFormat(range);
                quill.format('bold', !currentFormat.bold);
                updateOutput();
            }
        });

        // 監聽文字顏色選擇器
        textColorPicker.addEventListener('input', () => {
            const color = textColorPicker.value;
            quill.format('color', color);
            updateOutput();
        });

        // 監聽背景顏色選擇器
        bgColorPicker.addEventListener('input', () => {
            const color = bgColorPicker.value;
            quill.format('background', color);
            updateOutput();
        });

        // 自訂 Quill Blot 以添加圓角和間距
        const Inline = Quill.import('blots/inline');

        class BackgroundBlot extends Inline {
            static create(value) {
                let node = super.create();
                node.setAttribute('data-bg-color', value);
                node.classList.add('background-span');
                node.style.setProperty('--bg-color', value);
                return node;
            }

            static formats(node) {
                return node.getAttribute('data-bg-color');
            }

            format(name, value) {
                if (name === 'background' && value) {
                    this.domNode.setAttribute('data-bg-color', value);
                    this.domNode.style.setProperty('--bg-color', value);
                } else {
                    super.format(name, value);
                }
            }
        }

        BackgroundBlot.blotName = 'background';
        BackgroundBlot.tagName = 'span';
        BackgroundBlot.className = 'background-span';

        Quill.register(BackgroundBlot, true);

        // 更新預覽和 HTML 原始碼
        function updateOutput() {
            const html = quill.root.innerHTML;

            // 清理 Quill 的空標籤
            const cleanedHtml = html.replace(/<p><br><\/p>/g, '');

            // 更新預覽區
            preview.innerHTML = cleanedHtml;

            // 更新 HTML 原始碼區
            htmlOutput.value = cleanedHtml;
        }

        // 監聽編輯器內容變化
        quill.on('text-change', updateOutput);

        // 一鍵複製功能
        copyBtn.addEventListener('click', () => {
            htmlOutput.select();
            htmlOutput.setSelectionRange(0, 99999); // For mobile devices
            document.execCommand('copy');
            copyBtn.textContent = '已複製!';
            setTimeout(() => {
                copyBtn.textContent = '一鍵複製';
            }, 2000);
        });

        // 初始化預覽和 HTML 原始碼
        updateOutput();
    </script>
</body>
</html>
